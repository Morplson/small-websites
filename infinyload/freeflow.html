<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
    .grid {
  display: grid;
  grid-gap: 0.5rem;
  grid-template-columns: repeat(auto-fill, minmax(15rem,1fr));
  grid-auto-rows: 0;
}

/* Non-grid specific CSS */  
body {
  margin: 10px;
  color: #374046;
  background-color: #374046;
  font-size: 1.15em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}

.item {
  background-color: #ffffff;
  word-break:break-all;
  overflow: all;
}

  </style>

  <title></title>
  
  <script type="text/javascript">
/*
    function resizeGridItem(item){
  grid = document.getElementsByClassName("grid")[0];
  rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
  rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-row-gap'));
  rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height+rowGap)/(rowHeight+rowGap));
    item.style.gridRowEnd = "span "+rowSpan;
}

function resizeAllGridItems(){
  allItems = document.getElementsByClassName("item");
  for(x=0;x<allItems.length;x++){
    resizeGridItem(allItems[x]);
  }
}

function resizeInstance(instance){
  item = instance.elements[0];
  resizeGridItem(item);
}

window.addEventListener("load", resizeAllGridItems);
window.addEventListener("resize", resizeAllGridItems);

allItems = document.getElementsByClassName("item");
for(x=0;x<allItems.length;x++){
  imagesLoaded( allItems[x], resizeInstance);
}
*/




// infinyload

class Infinyload{
  constructor(){
    this.grid = document.getElementsByClassName("grid")[0];


    window.addEventListener("scroll", this.infinyload.bind(this));
    window.addEventListener("resize", this.resizeAllItems.bind(this));


    this.load();
    this.resizeAllItems();


    this.allItems = document.getElementsByClassName("item");
    for (var i = this.allItems.length - 1; i >= 0; i--) {
      this.allItems[i].addEventListener('load', this.resizeInstance.bind(this));
    }
  }

  infinyload(){
    console.log(eval(document.documentElement.scrollTop + document.documentElement.clientHeight)+" : "+eval(document.documentElement.scrollHeight-20));
    if (document.documentElement.scrollTop + document.documentElement.clientHeight >= document.documentElement.scrollHeight-20){

      this.load();
      this.resizeAllItems();

      this.allItems = document.getElementsByClassName("item");
      for (var i = this.allItems.length - 1; i >= 0; i--) {
        this.allItems[i].addEventListener('load', this.resizeInstance.bind(this));
      }
    }
  }

  resizeAllItems(){
    this.allItems = document.getElementsByClassName("item");
    for (var i = this.allItems.length - 1; i >= 0; i--) {
      this.resizeItem(this.allItems[i]);
    }
  }

  resizeItem(item){
    let rowHeight = parseInt(window.getComputedStyle(this.grid).getPropertyValue('grid-auto-rows'));
    let rowGap = parseInt(window.getComputedStyle(this.grid).getPropertyValue('grid-row-gap'));
    let rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height+rowGap)/(rowHeight+rowGap));
    item.style.gridRowEnd = "span "+rowSpan;
  }

  resizeInstance(instance){
    item = instance.elements[0];
    resizeGridItem(item);
  }



  load(){
    //TEST DIVS
    for (var i = 0; i <= 50; i++) {
      var div = document.createElement('div');
      div.setAttribute('class', 'item');
      div.innerHTML = "<div class='content'>"+i+" : "+makeid(Math.floor(Math.random()*100+1))+"</div>";

      this.grid.appendChild(div);
    }






  }
}

function makeid(length) {
   var result           = '';
   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
   var charactersLength = characters.length;
   for ( var i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
   }
   return result;
}




  </script>
</head>
<body>
<div class="grid">

</div>
<script type="text/javascript">
  var inf = new Infinyload();
</script>
</body>
</html>